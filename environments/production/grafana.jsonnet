local thanos =
  (import 'thanos-mixin/dashboards/query.libsonnet') +
  (import 'thanos-mixin/dashboards/store.libsonnet') +
  (import 'thanos-mixin/dashboards/receive.libsonnet') +
  (import 'thanos-mixin/dashboards/rule.libsonnet') +
  (import 'thanos-mixin/dashboards/compact.libsonnet') +
  (import 'thanos-mixin/dashboards/overview.libsonnet') +
  (import 'thanos-mixin/dashboards/defaults.libsonnet') +
  (import 'thanos-receive-controller-mixin/mixin.libsonnet') +
  (import 'selectors.libsonnet');

local jaeger = (import 'jaeger-mixin/mixin.libsonnet');
local k = import 'ksonnet/ksonnet.beta.4/k.libsonnet';
local memcached = (import 'memcached-mixin/mixin.libsonnet');

{
  ['grafana-dashboard-observatorium-thanos-%s.configmap' % std.split(name, '.')[0]]:
    local configmap = k.core.v1.configMap;
    configmap.new() +
    configmap.mixin.metadata.withName('grafana-dashboard-observatorium-thanos-%s' % std.split(name, '.')[0]) +
    configmap.withData({
      [name]: std.manifestJsonEx(thanos.grafanaDashboards[name] { tags: std.uniq(super.tags + ['observatorium']) }, '  '),
    })
  for name in std.objectFields(thanos.grafanaDashboards)
} + {
  ['grafana-dashboard-observatorium-jaeger-%s.configmap' % std.split(name, '.')[0]]:
    local configmap = k.core.v1.configMap;
    configmap.new() +
    configmap.mixin.metadata.withName('grafana-dashboard-observatorium-jaeger-%s' % std.split(name, '.')[0]) +
    configmap.withData({
      [name]: std.manifestJsonEx(jaeger.grafanaDashboards[name] { tags: std.uniq(super.tags + ['observatorium']) }, '  '),
    })
  for name in std.objectFields(jaeger.grafanaDashboards)
} + {
  ['grafana-dashboard-observatorium-memcached-%s.configmap' % std.split(name, '.')[0]]:
    local configmap = k.core.v1.configMap;
    configmap.new() +
    configmap.mixin.metadata.withName('grafana-dashboard-observatorium-memcached-%s' % std.split(name, '.')[0]) +
    configmap.withData({
      [name]: std.manifestJsonEx(memcached.grafanaDashboards[name] { tags: std.uniq(super.tags + ['observatorium']) }, '  '),
    })
  for name in std.objectFields(memcached.grafanaDashboards)
} + {
  'grafana-dashboard-observatorium-api.configmap':
    local configmap = k.core.v1.configMap;
    configmap.new() +
    configmap.mixin.metadata.withName('grafana-dashboard-observatorium-api') +
    configmap.withData({
      'observatorium-api.json': std.manifestJsonEx(
        {
          annotations: {
            list: [
              {
                builtIn: 1,
                datasource: '-- Grafana --',
                enable: true,
                hide: true,
                iconColor: 'rgba(0, 211, 255, 1)',
                name: 'Annotations & Alerts',
                type: 'dashboard',
              },
            ],
          },
          description: 'The Observatorium API is the entrypoint for read and write requests',
          editable: true,
          gnetId: null,
          graphTooltip: 1,
          iteration: 1587637883569,
          links: [],
          panels: [
            {
              collapsed: false,
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 0,
              },
              id: 116,
              panels: [],
              title: '/query & /query_legacy',
              type: 'row',
            },
            {
              cacheTimeout: null,
              colorBackground: false,
              colorValue: true,
              colors: [
                '#d44a3a',
                'rgba(237, 129, 40, 0.89)',
                '#299c46',
              ],
              datasource: '$datasource',
              decimals: 3,
              format: 'percentunit',
              gauge: {
                maxValue: 100,
                minValue: 0,
                show: false,
                thresholdLabels: false,
                thresholdMarkers: true,
              },
              gridPos: {
                h: 3,
                w: 12,
                x: 0,
                y: 1,
              },
              id: 114,
              interval: null,
              links: [],
              mappingType: 1,
              mappingTypes: [
                {
                  name: 'value to text',
                  value: 1,
                },
                {
                  name: 'range to text',
                  value: 2,
                },
              ],
              maxDataPoints: 100,
              nullPointMode: 'connected',
              nullText: null,
              options: {},
              postfix: '',
              postfixFontSize: '50%',
              prefix: '',
              prefixFontSize: '50%',
              rangeMaps: [
                {
                  from: 'null',
                  text: 'N/A',
                  to: 'null',
                },
              ],
              sparkline: {
                fillColor: 'rgba(31, 118, 189, 0.18)',
                full: false,
                lineColor: 'rgb(31, 120, 193)',
                show: false,
                ymax: null,
                ymin: null,
              },
              tableColumn: '',
              targets: [
                {
                  expr: 'sum(rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api",handler=~"query|query_legacy",le="1"}[28d]))\n/\nsum(rate(http_request_duration_seconds_count{job="observatorium-observatorium-api",handler=~"query|query_legacy"}[28d]))',
                  instant: true,
                  refId: 'A',
                },
              ],
              thresholds: '0.95,0.96',
              timeFrom: null,
              timeShift: null,
              title: 'Availability 1s [28d] > 95%',
              type: 'singlestat',
              valueFontSize: '120%',
              valueMaps: [
                {
                  op: '=',
                  text: 'N/A',
                  value: 'null',
                },
              ],
              valueName: 'current',
            },
            {
              cacheTimeout: null,
              colorBackground: false,
              colorValue: true,
              colors: [
                '#d44a3a',
                'rgba(237, 129, 40, 0.89)',
                '#299c46',
              ],
              datasource: '$datasource',
              decimals: 3,
              format: 'percentunit',
              gauge: {
                maxValue: 100,
                minValue: 0,
                show: false,
                thresholdLabels: false,
                thresholdMarkers: true,
              },
              gridPos: {
                h: 3,
                w: 12,
                x: 12,
                y: 1,
              },
              id: 128,
              interval: null,
              links: [],
              mappingType: 1,
              mappingTypes: [
                {
                  name: 'value to text',
                  value: 1,
                },
                {
                  name: 'range to text',
                  value: 2,
                },
              ],
              maxDataPoints: 100,
              nullPointMode: 'connected',
              nullText: null,
              options: {},
              postfix: '',
              postfixFontSize: '50%',
              prefix: '',
              prefixFontSize: '50%',
              rangeMaps: [
                {
                  from: 'null',
                  text: 'N/A',
                  to: 'null',
                },
              ],
              sparkline: {
                fillColor: 'rgba(31, 118, 189, 0.18)',
                full: false,
                lineColor: 'rgb(31, 120, 193)',
                show: false,
                ymax: null,
                ymin: null,
              },
              tableColumn: '',
              targets: [
                {
                  expr: 'sum(rate(http_request_duration_seconds_bucket{job="observatorium-thanos-query",handler="query",le="3",code!~"5.."}[28d]))\n/\nsum(rate(http_request_duration_seconds_count{job="observatorium-thanos-query",handler="query"}[28d]))',
                  instant: true,
                  refId: 'A',
                },
              ],
              thresholds: '0.99,0.992',
              timeFrom: null,
              timeShift: null,
              title: 'Availability 3s [28d] > 99%',
              type: 'singlestat',
              valueFontSize: '120%',
              valueMaps: [
                {
                  op: '=',
                  text: 'N/A',
                  value: 'null',
                },
              ],
              valueName: 'current',
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 0,
                y: 4,
              },
              hiddenSeries: false,
              id: 120,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: '/2../i',
                  color: '#56A64B',
                },
                {
                  alias: '/3../i',
                  color: '#5794F2',
                },
                {
                  alias: '/4../i',
                  color: '#FF9830',
                },
                {
                  alias: '/5../i',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum by (code) (rate(http_requests_total{job="observatorium-observatorium-api",handler=~"query|query_legacy"}[5m]))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '{{code}}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Requests',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 8,
                y: 4,
              },
              hiddenSeries: false,
              id: 123,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: 'errors',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(rate(http_requests_total{job="observatorium-observatorium-api",handler=~"query|query_legacy",code=~"5.."}[5m]))\n/\nsum(rate(http_requests_total{job="observatorium-observatorium-api",handler=~"query|query_legacy"}[5m]))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: 'errors',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Errors',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  decimals: null,
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: '0',
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 0,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 16,
                y: 4,
              },
              hiddenSeries: false,
              id: 91,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 1,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: '99th',
                  color: '#FA6400',
                },
                {
                  alias: '90th',
                  color: '#E0B400',
                },
                {
                  alias: '50th',
                  color: '#37872D',
                  fill: 10,
                  linewidth: 0,
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api",handler=~"query|query_legacy",code!~"5.."}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '99th',
                  refId: 'A',
                },
                {
                  expr: 'histogram_quantile(0.95, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api",handler=~"query|query_legacy",code!~"5.."}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '95th',
                  refId: 'B',
                },
                {
                  expr: 'histogram_quantile(0.50, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api",handler=~"query|query_legacy",code!~"5.."}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '50th',
                  refId: 'C',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Duration',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 's',
                  label: null,
                  logBase: 10,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              collapsed: false,
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 12,
              },
              id: 122,
              panels: [],
              title: '/query_range',
              type: 'row',
            },
            {
              cacheTimeout: null,
              colorBackground: false,
              colorValue: true,
              colors: [
                '#d44a3a',
                'rgba(237, 129, 40, 0.89)',
                '#299c46',
              ],
              datasource: '$datasource',
              decimals: 3,
              description: '',
              format: 'percentunit',
              gauge: {
                maxValue: 100,
                minValue: 0,
                show: false,
                thresholdLabels: false,
                thresholdMarkers: true,
              },
              gridPos: {
                h: 3,
                w: 12,
                x: 0,
                y: 13,
              },
              id: 118,
              interval: null,
              links: [],
              mappingType: 1,
              mappingTypes: [
                {
                  name: 'value to text',
                  value: 1,
                },
                {
                  name: 'range to text',
                  value: 2,
                },
              ],
              maxDataPoints: 100,
              nullPointMode: 'connected',
              nullText: null,
              options: {},
              postfix: '',
              postfixFontSize: '50%',
              prefix: '',
              prefixFontSize: '50%',
              rangeMaps: [
                {
                  from: 'null',
                  text: 'N/A',
                  to: 'null',
                },
              ],
              sparkline: {
                fillColor: 'rgba(31, 118, 189, 0.18)',
                full: false,
                lineColor: 'rgb(31, 120, 193)',
                show: false,
                ymax: null,
                ymin: null,
              },
              tableColumn: '',
              targets: [
                {
                  expr: 'sum(rate(http_request_duration_seconds_bucket{handler="query_range",le="60",code!~"5.."}[28d]))\n/\nsum(rate(http_request_duration_seconds_count{handler="query_range"}[28d]))',
                  instant: true,
                  refId: 'A',
                },
              ],
              thresholds: '0.90,0.92',
              timeFrom: null,
              timeShift: null,
              title: 'Availability 60s [28d] > 90%',
              type: 'singlestat',
              valueFontSize: '120%',
              valueMaps: [
                {
                  op: '=',
                  text: 'N/A',
                  value: 'null',
                },
              ],
              valueName: 'current',
            },
            {
              cacheTimeout: null,
              colorBackground: false,
              colorValue: true,
              colors: [
                '#d44a3a',
                'rgba(237, 129, 40, 0.89)',
                '#299c46',
              ],
              datasource: '$datasource',
              decimals: 3,
              description: '',
              format: 'percentunit',
              gauge: {
                maxValue: 100,
                minValue: 0,
                show: false,
                thresholdLabels: false,
                thresholdMarkers: true,
              },
              gridPos: {
                h: 3,
                w: 12,
                x: 12,
                y: 13,
              },
              id: 119,
              interval: null,
              links: [],
              mappingType: 1,
              mappingTypes: [
                {
                  name: 'value to text',
                  value: 1,
                },
                {
                  name: 'range to text',
                  value: 2,
                },
              ],
              maxDataPoints: 100,
              nullPointMode: 'connected',
              nullText: null,
              options: {},
              postfix: '',
              postfixFontSize: '50%',
              prefix: '',
              prefixFontSize: '50%',
              rangeMaps: [
                {
                  from: 'null',
                  text: 'N/A',
                  to: 'null',
                },
              ],
              sparkline: {
                fillColor: 'rgba(31, 118, 189, 0.18)',
                full: false,
                lineColor: 'rgb(31, 120, 193)',
                show: false,
                ymax: null,
                ymin: null,
              },
              tableColumn: '',
              targets: [
                {
                  expr: 'sum(increase(http_request_duration_seconds_bucket{handler="query_range",le="120",code!~"5.."}[28d]))\n/\nsum(increase(http_request_duration_seconds_count{handler="query_range"}[28d]))',
                  instant: true,
                  refId: 'A',
                },
              ],
              thresholds: '0.99,0.992',
              timeFrom: null,
              timeShift: null,
              title: 'Availability 120s [28d] > 99%',
              type: 'singlestat',
              valueFontSize: '120%',
              valueMaps: [
                {
                  op: '=',
                  text: 'N/A',
                  value: 'null',
                },
              ],
              valueName: 'current',
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 0,
                y: 16,
              },
              hiddenSeries: false,
              id: 125,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: '1xx',
                  color: '#FADE2A',
                },
                {
                  alias: '2xx',
                  color: '#56A64B',
                },
                {
                  alias: '3xx',
                  color: '#5794F2',
                },
                {
                  alias: '4xx',
                  color: '#FF9830',
                },
                {
                  alias: '5xx',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum by (code) (rate(http_requests_total{job="observatorium-thanos-query",handler="query_range"}[5m]))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '{{code}}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Requests',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 8,
                y: 16,
              },
              hiddenSeries: false,
              id: 126,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: 'errors',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(rate(http_requests_total{job="observatorium-thanos-query",handler="query_range",code=~"5.."}[5m])) / \nsum(rate(http_requests_total{job="observatorium-thanos-query",handler="query_range"}[5m]))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: 'errors',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Errors',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  decimals: null,
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: '0',
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 0,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 16,
                y: 16,
              },
              hiddenSeries: false,
              id: 127,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 1,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: '95th',
                  color: '#FA6400',
                },
                {
                  alias: '90th',
                  color: '#E0B400',
                },
                {
                  alias: '50th',
                  color: '#37872D',
                  fill: 10,
                  linewidth: 0,
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-thanos-query",code!~"5..",handler="query_range"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '99th',
                  refId: 'A',
                },
                {
                  expr: 'histogram_quantile(0.9, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-thanos-query",code!~"5..",handler="query_range"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '90th',
                  refId: 'B',
                },
                {
                  expr: 'histogram_quantile(0.5, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-thanos-query",code!~"5..",handler="query_range"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '50th',
                  refId: 'C',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Duration',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 's',
                  label: null,
                  logBase: 10,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              collapsed: false,
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 24,
              },
              id: 130,
              panels: [],
              repeat: 'handler',
              scopedVars: {
                handler: {
                  selected: false,
                  text: 'query_legacy',
                  value: 'query_legacy',
                },
              },
              title: 'RED for $handler',
              type: 'row',
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 6,
                w: 8,
                x: 0,
                y: 25,
              },
              hiddenSeries: false,
              id: 132,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              scopedVars: {
                handler: {
                  selected: false,
                  text: 'query_legacy',
                  value: 'query_legacy',
                },
              },
              seriesOverrides: [
                {
                  alias: '/2../i',
                  color: '#56A64B',
                },
                {
                  alias: '/3../i',
                  color: '#F2CC0C',
                },
                {
                  alias: '/4../i',
                  color: '#3274D9',
                },
                {
                  alias: '/5../i',
                  color: '#E02F44',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum by (code) (rate(http_requests_total{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler"}[5m]))',
                  legendFormat: '{{ code }}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Requests',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 6,
                w: 8,
                x: 8,
                y: 25,
              },
              hiddenSeries: false,
              id: 133,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              scopedVars: {
                handler: {
                  selected: false,
                  text: 'query_legacy',
                  value: 'query_legacy',
                },
              },
              seriesOverrides: [
                {
                  alias: 'errors',
                  color: '#E02F44',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(rate(http_requests_total{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler",code=~"5.."}[5m]))\n/\nsum(rate(http_requests_total{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler"}[5m]))',
                  legendFormat: 'errors',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Errors',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 0,
              fillGradient: 0,
              gridPos: {
                h: 6,
                w: 8,
                x: 16,
                y: 25,
              },
              hiddenSeries: false,
              id: 134,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 1,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              scopedVars: {
                handler: {
                  selected: false,
                  text: 'query_legacy',
                  value: 'query_legacy',
                },
              },
              seriesOverrides: [
                {
                  alias: 'p99',
                  color: '#E02F44',
                },
                {
                  alias: 'p90',
                  color: '#F2CC0C',
                },
                {
                  alias: 'p50',
                  color: '#56A64B',
                  fill: 10,
                  linewidth: 0,
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'histogram_quantile(0.50, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler",code!~"5.."}[5m])))',
                  legendFormat: 'p50',
                  refId: 'C',
                },
                {
                  expr: 'histogram_quantile(0.90, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler",code!~"5.."}[5m])))',
                  legendFormat: 'p90',
                  refId: 'B',
                },
                {
                  expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler",code!~"5.."}[5m])))',
                  legendFormat: 'p99',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Duration',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 's',
                  label: null,
                  logBase: 10,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              collapsed: false,
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 31,
              },
              id: 135,
              panels: [],
              repeat: null,
              repeatIteration: 1587637883569,
              repeatPanelId: 130,
              scopedVars: {
                handler: {
                  selected: false,
                  text: 'write',
                  value: 'write',
                },
              },
              title: 'RED for $handler',
              type: 'row',
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 6,
                w: 8,
                x: 0,
                y: 32,
              },
              hiddenSeries: false,
              id: 136,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              repeatIteration: 1587637883569,
              repeatPanelId: 132,
              repeatedByRow: true,
              scopedVars: {
                handler: {
                  selected: false,
                  text: 'write',
                  value: 'write',
                },
              },
              seriesOverrides: [
                {
                  alias: '/2../i',
                  color: '#56A64B',
                },
                {
                  alias: '/3../i',
                  color: '#F2CC0C',
                },
                {
                  alias: '/4../i',
                  color: '#3274D9',
                },
                {
                  alias: '/5../i',
                  color: '#E02F44',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum by (code) (rate(http_requests_total{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler"}[5m]))',
                  legendFormat: '{{ code }}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Requests',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 6,
                w: 8,
                x: 8,
                y: 32,
              },
              hiddenSeries: false,
              id: 137,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              repeatIteration: 1587637883569,
              repeatPanelId: 133,
              repeatedByRow: true,
              scopedVars: {
                handler: {
                  selected: false,
                  text: 'write',
                  value: 'write',
                },
              },
              seriesOverrides: [
                {
                  alias: 'errors',
                  color: '#E02F44',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(rate(http_requests_total{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler",code=~"5.."}[5m]))\n/\nsum(rate(http_requests_total{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler"}[5m]))',
                  legendFormat: 'errors',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Errors',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 0,
              fillGradient: 0,
              gridPos: {
                h: 6,
                w: 8,
                x: 16,
                y: 32,
              },
              hiddenSeries: false,
              id: 138,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 1,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              repeatIteration: 1587637883569,
              repeatPanelId: 134,
              repeatedByRow: true,
              scopedVars: {
                handler: {
                  selected: false,
                  text: 'write',
                  value: 'write',
                },
              },
              seriesOverrides: [
                {
                  alias: 'p99',
                  color: '#E02F44',
                },
                {
                  alias: 'p90',
                  color: '#F2CC0C',
                },
                {
                  alias: 'p50',
                  color: '#56A64B',
                  fill: 10,
                  linewidth: 0,
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'histogram_quantile(0.50, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler",code!~"5.."}[5m])))',
                  legendFormat: 'p50',
                  refId: 'C',
                },
                {
                  expr: 'histogram_quantile(0.90, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler",code!~"5.."}[5m])))',
                  legendFormat: 'p90',
                  refId: 'B',
                },
                {
                  expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="observatorium-observatorium-api", namespace="$namespace", handler=~"$handler",code!~"5.."}[5m])))',
                  legendFormat: 'p99',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Duration',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 's',
                  label: null,
                  logBase: 10,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
          ],
          refresh: '1m',
          schemaVersion: 22,
          style: 'dark',
          tags: [
            'observatorium',
          ],
          templating: {
            list: [
              {
                current: {
                  selected: true,
                  tags: [],
                  text: 'app-sre-stage-01-prometheus',
                  value: 'app-sre-stage-01-prometheus',
                },
                hide: 0,
                includeAll: false,
                label: null,
                multi: false,
                name: 'datasource',
                options: [],
                query: 'prometheus',
                refresh: 1,
                regex: '',
                skipUrlSync: false,
                type: 'datasource',
              },
              {
                allValue: null,
                current: {
                  isNone: true,
                  selected: true,
                  text: 'None',
                  value: '',
                },
                datasource: '$datasource',
                definition: 'label_values(kube_pod_info, cluster)',
                hide: 0,
                includeAll: false,
                label: 'cluster',
                multi: false,
                name: 'cluster',
                options: [],
                query: 'label_values(kube_pod_info, cluster)',
                refresh: 1,
                regex: '',
                skipUrlSync: false,
                sort: 0,
                tagValuesQuery: '',
                tags: [],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
              {
                allValue: null,
                current: {
                  text: 'telemeter-stage',
                  value: 'telemeter-stage',
                },
                datasource: '$datasource',
                definition: 'label_values(kube_pod_info{cluster="$cluster"}, namespace)',
                hide: 0,
                includeAll: false,
                label: 'namespace',
                multi: false,
                name: 'namespace',
                options: [],
                query: 'label_values(kube_pod_info{cluster="$cluster"}, namespace)',
                refresh: 1,
                regex: '^telemeter.*',
                skipUrlSync: false,
                sort: 2,
                tagValuesQuery: '',
                tags: [],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
              {
                allValue: null,
                current: {
                  text: 'All',
                  value: [
                    '$__all',
                  ],
                },
                datasource: '$datasource',
                definition: 'label_values(http_requests_total{job="observatorium-observatorium-api", namespace="$namespace"}, handler)',
                hide: 0,
                includeAll: true,
                label: null,
                multi: true,
                name: 'handler',
                options: [],
                query: 'label_values(http_requests_total{job="observatorium-observatorium-api", namespace="$namespace"}, handler)',
                refresh: 1,
                regex: '(query.*|write)',
                skipUrlSync: false,
                sort: 1,
                tagValuesQuery: '',
                tags: [],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
            ],
          },
          time: {
            from: 'now-3h',
            to: 'now',
          },
          timepicker: {
            refresh_intervals: [
              '5s',
              '10s',
              '30s',
              '1m',
              '5m',
              '15m',
              '30m',
              '1h',
              '2h',
              '1d',
            ],
            time_options: [
              '5m',
              '15m',
              '1h',
              '6h',
              '12h',
              '24h',
              '2d',
              '7d',
              '30d',
            ],
          },
          timezone: 'UTC',
          title: 'API',
          uid: 'Tg-mH0rizaSJDKSADX',
          version: 1,
        }, '  ',
      ),
    }),
} + {
  'grafana-dashboard-observatorium-thanos-sidecar.configmap':
    local configmap = k.core.v1.configMap;
    configmap.new() +
    configmap.mixin.metadata.withName('grafana-dashboard-observatorium-thanos-sidecar') +
    configmap.withData({
      'sidecar.json': std.manifestJsonEx(
        {
          annotations: {
            list: [

            ],
          },
          editable: true,
          gnetId: null,
          graphTooltip: 0,
          hideControls: false,
          links: [

          ],
          refresh: '10s',
          rows: [
            {
              collapse: false,
              height: '250px',
              panels: [
                {
                  aliasColors: {
                    Aborted: '#EAB839',
                    AlreadyExists: '#7EB26D',
                    Canceled: '#E24D42',
                    DataLoss: '#E24D42',
                    DeadlineExceeded: '#E24D42',
                    FailedPrecondition: '#6ED0E0',
                    Internal: '#E24D42',
                    InvalidArgument: '#EF843C',
                    NotFound: '#EF843C',
                    OK: '#7EB26D',
                    OutOfRange: '#E24D42',
                    PermissionDenied: '#EF843C',
                    ResourceExhausted: '#E24D42',
                    Unauthenticated: '#EF843C',
                    Unavailable: '#E24D42',
                    Unimplemented: '#6ED0E0',
                    Unknown: '#E24D42',
                    'error': '#E24D42',
                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 1,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(grpc_server_handled_total{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job, grpc_code)',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{job}} {{grpc_code}}',
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Rate',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {
                    'error': '#E24D42',
                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 2,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(grpc_server_handled_total{grpc_code!="OK",namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) / sum(rate(grpc_server_started_total{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval]))',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'error',
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Errors',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'percentunit',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 3,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'histogram_quantile(0.99, sum(rate(grpc_server_handling_seconds_bucket{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P99 {{job}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'sum(rate(grpc_server_handling_seconds_sum{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job) * 1\n/\nsum(rate(grpc_server_handling_seconds_count{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job)\n',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'mean {{job}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'histogram_quantile(0.50, sum(rate(grpc_server_handling_seconds_bucket{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P50 {{job}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Duration',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 's',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
              ],
              repeat: null,
              repeatIteration: null,
              repeatRowId: null,
              showTitle: true,
              title: 'gRPC (Unary)',
              titleSize: 'h6',
            },
            {
              collapse: true,
              height: '250px',
              panels: [
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 4,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(grpc_server_handled_total{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job, grpc_method, grpc_code)',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{job}} {{grpc_method}} {{grpc_code}}',
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Rate',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 5,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(grpc_server_handled_total{grpc_code!="OK",namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job, grpc_method, grpc_code)\n',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{job}} {{grpc_method}} {{grpc_code}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Errors',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 6,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'histogram_quantile(0.99, sum(rate(grpc_server_handling_seconds_bucket{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job, grpc_method, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P99 {{job}} {{grpc_method}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'sum(rate(grpc_server_handling_seconds_sum{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job) * 1\n/\nsum(rate(grpc_server_handling_seconds_count{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job)\n',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'mean {{job}} {{grpc_method}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'histogram_quantile(0.50, sum(rate(grpc_server_handling_seconds_bucket{namespace="$namespace",job=~"$job",grpc_type="unary"}[$interval])) by (job, grpc_method, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P50 {{job}} {{grpc_method}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Duration',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 's',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
              ],
              repeat: null,
              repeatIteration: null,
              repeatRowId: null,
              showTitle: true,
              title: 'Detailed',
              titleSize: 'h6',
            },
            {
              collapse: false,
              height: '250px',
              panels: [
                {
                  aliasColors: {
                    Aborted: '#EAB839',
                    AlreadyExists: '#7EB26D',
                    Canceled: '#E24D42',
                    DataLoss: '#E24D42',
                    DeadlineExceeded: '#E24D42',
                    FailedPrecondition: '#6ED0E0',
                    Internal: '#E24D42',
                    InvalidArgument: '#EF843C',
                    NotFound: '#EF843C',
                    OK: '#7EB26D',
                    OutOfRange: '#E24D42',
                    PermissionDenied: '#EF843C',
                    ResourceExhausted: '#E24D42',
                    Unauthenticated: '#EF843C',
                    Unavailable: '#E24D42',
                    Unimplemented: '#6ED0E0',
                    Unknown: '#E24D42',
                    'error': '#E24D42',
                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 7,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(grpc_server_handled_total{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job, grpc_code)',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{job}} {{grpc_code}}',
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Rate',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {
                    'error': '#E24D42',
                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 8,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(grpc_server_handled_total{grpc_code!="OK",namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) / sum(rate(grpc_server_started_total{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval]))',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'error',
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Errors',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'percentunit',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 9,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'histogram_quantile(0.99, sum(rate(grpc_server_handling_seconds_bucket{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P99 {{job}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'sum(rate(grpc_server_handling_seconds_sum{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job) * 1\n/\nsum(rate(grpc_server_handling_seconds_count{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job)\n',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'mean {{job}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'histogram_quantile(0.50, sum(rate(grpc_server_handling_seconds_bucket{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P50 {{job}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Duration',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 's',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
              ],
              repeat: null,
              repeatIteration: null,
              repeatRowId: null,
              showTitle: true,
              title: 'gRPC (Stream)',
              titleSize: 'h6',
            },
            {
              collapse: true,
              height: '250px',
              panels: [
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 10,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(grpc_client_handled_total{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job, grpc_method, grpc_code)',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{job}} {{grpc_method}} {{grpc_code}}',
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Rate',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 11,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(grpc_client_handled_total{grpc_code!="OK",namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job, grpc_method, grpc_code)\n',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{job}} {{grpc_method}} {{grpc_code}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Errors',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 12,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'histogram_quantile(0.99, sum(rate(grpc_client_handling_seconds_bucket{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job, grpc_method, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P99 {{job}} {{grpc_method}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'sum(rate(grpc_client_handling_seconds_sum{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job) * 1\n/\nsum(rate(grpc_client_handling_seconds_count{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job)\n',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'mean {{job}} {{grpc_method}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'histogram_quantile(0.50, sum(rate(grpc_client_handling_seconds_bucket{namespace="$namespace",job=~"$job",grpc_type="server_stream"}[$interval])) by (job, grpc_method, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P50 {{job}} {{grpc_method}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Duration',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 's',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
              ],
              repeat: null,
              repeatIteration: null,
              repeatRowId: null,
              showTitle: true,
              title: 'Detailed',
              titleSize: 'h6',
            },
            {
              collapse: false,
              height: '250px',
              panels: [
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 13,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 12,
                  stack: false,
                  steppedLine: false,
                  styles: [
                    {
                      alias: 'Time',
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      pattern: 'Time',
                      type: 'hidden',
                    },
                    {
                      alias: 'Uploaded Ago',
                      colorMode: null,
                      colors: [

                      ],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value',
                      thresholds: [

                      ],
                      type: 'number',
                      unit: 's',
                    },
                    {
                      alias: '',
                      colorMode: null,
                      colors: [

                      ],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      pattern: '/.*/',
                      thresholds: [

                      ],
                      type: 'string',
                      unit: 'short',
                    },
                  ],
                  targets: [
                    {
                      expr: 'time() - max(thanos_objstore_bucket_last_successful_upload_time{namespace="$namespace",job=~"$job"}) by (job, bucket)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Successful Upload',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  transform: 'table',
                  type: 'table',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
              ],
              repeat: null,
              repeatIteration: null,
              repeatRowId: null,
              showTitle: true,
              title: 'Last Updated',
              titleSize: 'h6',
            },
            {
              collapse: false,
              height: '250px',
              panels: [
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 14,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(thanos_objstore_bucket_operations_total{namespace="$namespace",job=~"$job"}[$interval])) by (job, operation)',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{job}} {{operation}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Rate',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {
                    'error': '#E24D42',
                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  id: 15,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(rate(thanos_objstore_bucket_operation_failures_total{namespace="$namespace",job=~"$job"}[$interval])) / sum(rate(thanos_objstore_bucket_operations_total{namespace="$namespace",job=~"$job"}[$interval]))',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'error',
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Errors',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'percentunit',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 16,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'histogram_quantile(0.99, sum(rate(thanos_objstore_bucket_operation_duration_seconds_bucket{namespace="$namespace",job=~"$job"}[$interval])) by (job, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P99 {{job}}',
                      refId: 'A',
                      step: 10,
                    },
                    {
                      expr: 'sum(rate(thanos_objstore_bucket_operation_duration_seconds_sum{namespace="$namespace",job=~"$job"}[$interval])) by (job) * 1 / sum(rate(thanos_objstore_bucket_operation_duration_seconds_count{namespace="$namespace",job=~"$job"}[$interval])) by (job)',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'mean {{job}}',
                      refId: 'B',
                      step: 10,
                    },
                    {
                      expr: 'histogram_quantile(0.50, sum(rate(thanos_objstore_bucket_operation_duration_seconds_bucket{namespace="$namespace",job=~"$job"}[$interval])) by (job, le)) * 1',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'P50 {{job}}',
                      refId: 'C',
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Duration',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 's',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
              ],
              repeat: null,
              repeatIteration: null,
              repeatRowId: null,
              showTitle: true,
              title: 'Bucket Operations',
              titleSize: 'h6',
            },
            {
              collapse: true,
              height: '250px',
              panels: [
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 17,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'go_memstats_alloc_bytes{namespace="$namespace",job=~"$job",kubernetes_pod_name=~"$pod"}',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'alloc all {{pod}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'go_memstats_heap_alloc_bytes{namespace="$namespace",job=~"$job",kubernetes_pod_name=~"$pod"}',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'alloc heap {{pod}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'rate(go_memstats_alloc_bytes_total{namespace="$namespace",job=~"$job",kubernetes_pod_name=~"$pod"}[30s])',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'alloc rate all {{pod}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'rate(go_memstats_heap_alloc_bytes{namespace="$namespace",job=~"$job",kubernetes_pod_name=~"$pod"}[30s])',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'alloc rate heap {{pod}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'go_memstats_stack_inuse_bytes{namespace="$namespace",job=~"$job",kubernetes_pod_name=~"$pod"}',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'inuse stack {{pod}}',
                      legendLink: null,
                      step: 10,
                    },
                    {
                      expr: 'go_memstats_heap_inuse_bytes{namespace="$namespace",job=~"$job",kubernetes_pod_name=~"$pod"}',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: 'inuse heap {{pod}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Memory Used',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 18,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'go_goroutines{namespace="$namespace",job=~"$job"}',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{pod}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Goroutines',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {

                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  id: 19,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [

                  ],
                  nullPointMode: 'null as zero',
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [

                  ],
                  spaceLength: 10,
                  span: 4,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'go_gc_duration_seconds{namespace="$namespace",job=~"$job",kubernetes_pod_name=~"$pod"}',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{quantile}} {{pod}}',
                      legendLink: null,
                      step: 10,
                    },
                  ],
                  thresholds: [

                  ],
                  timeFrom: null,
                  timeShift: null,
                  title: 'GC Time Quantiles',
                  tooltip: {
                    shared: false,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [

                    ],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
              ],
              repeat: null,
              repeatIteration: null,
              repeatRowId: null,
              showTitle: true,
              title: 'Resources',
              titleSize: 'h6',
            },
          ],
          schemaVersion: 14,
          style: 'dark',
          tags: [
            'thanos-mixin',
          ],
          templating: {
            list: [
              {
                current: {
                  text: 'Prometheus',
                  value: 'Prometheus',
                },
                hide: 0,
                label: null,
                name: 'datasource',
                options: [

                ],
                query: 'prometheus',
                refresh: 1,
                regex: '',
                type: 'datasource',
              },
              {
                allValue: null,
                current: {

                },
                datasource: '$datasource',
                hide: 0,
                includeAll: false,
                label: 'namespace',
                multi: false,
                name: 'namespace',
                options: [

                ],
                query: 'label_values(kube_pod_info{}, namespace)',
                refresh: 1,
                regex: '',
                sort: 2,
                tagValuesQuery: '',
                tags: [

                ],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
              {
                allValue: 'thanos-sidecar.*',
                current: {
                  text: 'all',
                  value: '$__all',
                },
                datasource: '$datasource',
                hide: 0,
                includeAll: true,
                label: 'job',
                multi: false,
                name: 'job',
                options: [

                ],
                query: 'label_values(up{namespace="$namespace",job=~"thanos-sidecar.*"}, job)',
                refresh: 1,
                regex: '',
                sort: 2,
                tagValuesQuery: '',
                tags: [

                ],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
              {
                allValue: '.*',
                current: {
                  text: 'all',
                  value: '$__all',
                },
                datasource: '$datasource',
                hide: 0,
                includeAll: true,
                label: 'pod',
                multi: false,
                name: 'pod',
                options: [

                ],
                query: 'label_values(kube_pod_info{namespace="$namespace",created_by_name=~"thanos-sidecar.*"}, pod)',
                refresh: 1,
                regex: '',
                sort: 2,
                tagValuesQuery: '',
                tags: [

                ],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
              {
                auto: true,
                auto_count: 300,
                auto_min: '10s',
                current: {
                  text: '5m',
                  value: '5m',
                },
                hide: 0,
                label: 'interval',
                name: 'interval',
                query: '5m,10m,30m,1h,6h,12h',
                refresh: 2,
                type: 'interval',
              },
            ],
          },
          time: {
            from: 'now-1h',
            to: 'now',
          },
          timepicker: {
            refresh_intervals: [
              '5s',
              '10s',
              '30s',
              '1m',
              '5m',
              '15m',
              '30m',
              '1h',
              '2h',
              '1d',
            ],
            time_options: [
              '5m',
              '15m',
              '1h',
              '6h',
              '12h',
              '24h',
              '2d',
              '7d',
              '30d',
            ],
          },
          timezone: '',
          title: 'Thanos / Sidecar',
          uid: 'b19644bfbf0ec1e108027cce268d99f7',
          version: 0,
        }, '  ',
      ),
    }),
} + {
  'grafana-dashboard-telemeter-canary.configmap':
    local configmap = k.core.v1.configMap;
    configmap.new() +
    configmap.mixin.metadata.withName('grafana-dashboard-telemeter-canary') +
    configmap.withData({
      'telemeter-canary.json': std.manifestJsonEx(
        {
          annotations: {
            list: [
              {
                builtIn: 1,
                datasource: '-- Grafana --',
                enable: true,
                hide: true,
                iconColor: 'rgba(0, 211, 255, 1)',
                name: 'Annotations & Alerts',
                type: 'dashboard',
              },
            ],
          },
          editable: true,
          gnetId: null,
          graphTooltip: 0,
          id: 63,
          iteration: 1588077527884,
          links: [],
          panels: [
            {
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 0,
              },
              id: 4,
              title: 'All Handlers',
              type: 'row',
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 0,
                y: 1,
              },
              hiddenSeries: false,
              id: 5,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              seriesOverrides: [
                {
                  alias: '/2../i',
                  color: '#73BF69',
                },
                {
                  alias: '/3../i',
                  color: '#FADE2A',
                },
                {
                  alias: '/4../i',
                  color: '#8AB8FF',
                },
                {
                  alias: '/5../i',
                  color: '#E02F44',
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum by (code) (rate(http_requests_total{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-canary-\\\\d"}[5m]))',
                  legendFormat: '{{ code }}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Requests (Canary)',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 8,
                y: 1,
              },
              hiddenSeries: false,
              id: 7,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              seriesOverrides: [
                {
                  alias: 'errors',
                  color: '#E02F44',
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(rate(http_requests_total{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-canary-\\\\d",code=~"5.."}[5m]))\n/\nsum(rate(http_requests_total{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-canary-\\\\d"}[5m]))',
                  legendFormat: 'errors',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Errors (Canary)',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 1,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 16,
                y: 1,
              },
              hiddenSeries: false,
              id: 9,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 1,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              seriesOverrides: [
                {
                  alias: 'p99',
                  color: '#E02F44',
                  fill: 0,
                },
                {
                  alias: 'p90',
                  color: '#FFEE52',
                  fill: 0,
                },
                {
                  alias: 'p50',
                  color: '#56A64B',
                  fill: 10,
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-canary-\\\\d",code!~"5.."}[5m])))',
                  legendFormat: 'p99',
                  refId: 'A',
                },
                {
                  expr: 'histogram_quantile(0.90, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-canary-\\\\d",code!~"5.."}[5m])))',
                  legendFormat: 'p90',
                  refId: 'B',
                },
                {
                  expr: 'histogram_quantile(0.50, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-canary-\\\\d",code!~"5.."}[5m])))',
                  legendFormat: 'p50',
                  refId: 'C',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Duration (Canary)',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 's',
                  label: null,
                  logBase: 10,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 0,
                y: 9,
              },
              hiddenSeries: false,
              id: 2,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              seriesOverrides: [
                {
                  alias: '/2../i',
                  color: '#73BF69',
                },
                {
                  alias: '/3../i',
                  color: '#FADE2A',
                },
                {
                  alias: '/4../i',
                  color: '#8AB8FF',
                },
                {
                  alias: '/5../i',
                  color: '#E02F44',
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum by (code) (rate(http_requests_total{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-\\\\d"}[5m]))',
                  legendFormat: '{{ code }}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Requests',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 8,
                y: 9,
              },
              hiddenSeries: false,
              id: 6,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              seriesOverrides: [
                {
                  alias: 'errors',
                  color: '#E02F44',
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(rate(http_requests_total{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-\\\\d",code=~"5.."}[5m]))\n/\nsum(rate(http_requests_total{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-\\\\d"}[5m]))',
                  legendFormat: 'errors',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Errors',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {},
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 1,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 8,
                x: 16,
                y: 9,
              },
              hiddenSeries: false,
              id: 8,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 1,
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              seriesOverrides: [
                {
                  alias: 'p99',
                  color: '#E02F44',
                  fill: 0,
                },
                {
                  alias: 'p90',
                  color: '#FFEE52',
                  fill: 0,
                },
                {
                  alias: 'p50',
                  color: '#56A64B',
                  fill: 10,
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-\\\\d",code!~"5.."}[5m])))',
                  legendFormat: 'p99',
                  refId: 'A',
                },
                {
                  expr: 'histogram_quantile(0.90, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-\\\\d",code!~"5.."}[5m])))',
                  legendFormat: 'p90',
                  refId: 'B',
                },
                {
                  expr: 'histogram_quantile(0.50, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",namespace="$namespace",pod=~"telemeter-server-\\\\d",code!~"5.."}[5m])))',
                  legendFormat: 'p50',
                  refId: 'C',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Duration',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 's',
                  label: null,
                  logBase: 10,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
          ],
          refresh: '10s',
          schemaVersion: 22,
          style: 'dark',
          tags: [],
          templating: {
            list: [
              {
                current: {
                  selected: true,
                  text: 'app-sre-stage-01-prometheus',
                  value: 'app-sre-stage-01-prometheus',
                },
                hide: 0,
                includeAll: false,
                label: null,
                multi: false,
                name: 'datasource',
                options: [],
                query: 'prometheus',
                refresh: 1,
                regex: '',
                skipUrlSync: false,
                type: 'datasource',
              },
              {
                allValue: null,
                current: {
                  selected: true,
                  text: 'telemeter-stage',
                  value: 'telemeter-stage',
                },
                datasource: '$datasource',
                definition: 'label_values(kube_pod_info, namespace)',
                hide: 0,
                includeAll: false,
                label: 'namespace',
                multi: false,
                name: 'namespace',
                options: [],
                query: 'label_values(kube_pod_info, namespace)',
                refresh: 1,
                regex: '^telemeter.*',
                skipUrlSync: false,
                sort: 1,
                tagValuesQuery: '',
                tags: [],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
            ],
          },
          time: {
            from: 'now-15m',
            to: 'now',
          },
          timepicker: {
            refresh_intervals: [
              '5s',
              '10s',
              '30s',
              '1m',
              '5m',
              '15m',
              '30m',
              '1h',
              '2h',
              '1d',
            ],
          },
          timezone: '',
          title: 'Telemeter Canary Deployment',
          uid: 'cMKrkf3Wk',
          version: 5,
        }, '  ',
      ),
    }),
} + {
  'grafana-dashboard-telemeter.configmap':
    local configmap = k.core.v1.configMap;
    configmap.new() +
    configmap.mixin.metadata.withName('grafana-dashboard-telemeter') +
    configmap.withData({
      'telemeter.json': std.manifestJsonEx(
        {
          annotations: {
            list: [
              {
                builtIn: 1,
                datasource: '-- Grafana --',
                enable: true,
                hide: true,
                iconColor: 'rgba(0, 211, 255, 1)',
                name: 'Annotations & Alerts',
                type: 'dashboard',
              },
            ],
          },
          editable: true,
          gnetId: null,
          graphTooltip: 1,
          iteration: 1592219595074,
          links: [],
          panels: [
            {
              collapsed: false,
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 0,
              },
              id: 108,
              panels: [],
              title: 'Telemeter v1 (/authorize & /upload)',
              type: 'row',
            },
            {
              cacheTimeout: null,
              colorBackground: false,
              colorValue: true,
              colors: [
                '#d44a3a',
                'rgba(237, 129, 40, 0.89)',
                '#299c46',
              ],
              datasource: '$datasource',
              format: 'percentunit',
              gauge: {
                maxValue: 100,
                minValue: 0,
                show: false,
                thresholdLabels: false,
                thresholdMarkers: true,
              },
              gridPos: {
                h: 8,
                w: 5,
                x: 0,
                y: 1,
              },
              id: 113,
              interval: null,
              links: [],
              mappingType: 1,
              mappingTypes: [
                {
                  name: 'value to text',
                  value: 1,
                },
                {
                  name: 'range to text',
                  value: 2,
                },
              ],
              maxDataPoints: 100,
              nullPointMode: 'connected',
              nullText: null,
              options: {},
              postfix: '',
              postfixFontSize: '50%',
              prefix: '',
              prefixFontSize: '50%',
              rangeMaps: [
                {
                  from: 'null',
                  text: 'N/A',
                  to: 'null',
                },
              ],
              sparkline: {
                fillColor: 'rgba(31, 118, 189, 0.18)',
                full: false,
                lineColor: 'rgb(31, 120, 193)',
                show: false,
                ymax: null,
                ymin: null,
              },
              tableColumn: '',
              targets: [
                {
                  expr: '1 -\nsum(increase(haproxy_server_http_responses_total{route=~"telemeter-server-authorize|telemeter-server-upload",code="5xx"}[28d]))\n/\nsum(increase(haproxy_server_http_responses_total{route=~"telemeter-server-authorize|telemeter-server-upload"}[28d]))\n',
                  instant: true,
                  refId: 'A',
                },
              ],
              thresholds: '0.98,0.985',
              timeFrom: null,
              timeShift: null,
              title: 'Availability (28d)',
              type: 'singlestat',
              valueFontSize: '120%',
              valueMaps: [
                {
                  op: '=',
                  text: 'N/A',
                  value: 'null',
                },
              ],
              valueName: 'current',
            },
            {
              aliasColors: {},
              bars: false,
              cacheTimeout: null,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 8,
                w: 19,
                x: 5,
                y: 1,
              },
              hiddenSeries: false,
              id: 114,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: false,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              seriesOverrides: [
                {},
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: '(\n  (\n    1 -\n    sum(increase(haproxy_server_http_responses_total{route=~"telemeter-server-authorize|telemeter-server-upload",code="5xx"}[28d]))\n    /\n    sum(increase(haproxy_server_http_responses_total{route=~"telemeter-server-authorize|telemeter-server-upload"}[28d]))\n  ) - 0.98\n)\n/ \n(1 - 0.98)',
                  instant: false,
                  intervalFactor: 10,
                  legendFormat: 'errorbudget',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Error Budget (28d)',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  decimals: null,
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: false,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 9,
              },
              id: 102,
              title: '/authorize',
              type: 'row',
            },
            {
              cacheTimeout: null,
              colorBackground: false,
              colorPostfix: false,
              colorValue: true,
              colors: [
                '#d44a3a',
                'rgba(237, 129, 40, 0.89)',
                '#299c46',
              ],
              datasource: '$datasource',
              decimals: 3,
              format: 'percentunit',
              gauge: {
                maxValue: 100,
                minValue: 0,
                show: false,
                thresholdLabels: false,
                thresholdMarkers: true,
              },
              gridPos: {
                h: 9,
                w: 3,
                x: 0,
                y: 10,
              },
              id: 104,
              interval: null,
              links: [],
              mappingType: 1,
              mappingTypes: [
                {
                  name: 'value to text',
                  value: 1,
                },
                {
                  name: 'range to text',
                  value: 2,
                },
              ],
              maxDataPoints: 100,
              nullPointMode: 'connected',
              nullText: null,
              options: {},
              postfix: '',
              postfixFontSize: '50%',
              prefix: '',
              prefixFontSize: '50%',
              rangeMaps: [
                {
                  from: 'null',
                  text: 'N/A',
                  to: 'null',
                },
              ],
              sparkline: {
                fillColor: 'rgba(31, 118, 189, 0.18)',
                full: false,
                lineColor: 'rgb(31, 120, 193)',
                show: false,
                ymax: null,
                ymin: null,
              },
              tableColumn: '',
              targets: [
                {
                  expr: '1 -\nsum(increase(haproxy_server_http_responses_total{route="telemeter-server-authorize",code="5xx"}[$__range]))\n/\nsum(increase(haproxy_server_http_responses_total{route="telemeter-server-authorize"}[$__range]))',
                  instant: true,
                  refId: 'A',
                },
              ],
              thresholds: '.98,0.985',
              timeFrom: null,
              timeShift: null,
              title: 'Availability (selected time range)',
              type: 'singlestat',
              valueFontSize: '80%',
              valueMaps: [
                {
                  op: '=',
                  text: 'N/A',
                  value: 'null',
                },
              ],
              valueName: 'current',
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 9,
                w: 7,
                x: 3,
                y: 10,
              },
              hiddenSeries: false,
              id: 70,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeat: 'handler',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: '1xx',
                  color: '#FADE2A',
                },
                {
                  alias: '2xx',
                  color: '#56A64B',
                },
                {
                  alias: '3xx',
                  color: '#5794F2',
                },
                {
                  alias: '4xx',
                  color: '#FF9830',
                },
                {
                  alias: '5xx',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum by (code) (rate(haproxy_server_http_responses_total{route="telemeter-server-authorize"}[5m]))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '{{code}}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Requests',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 9,
                w: 7,
                x: 10,
                y: 10,
              },
              hiddenSeries: false,
              id: 96,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: 'errors',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(rate(haproxy_server_http_responses_total{route="telemeter-server-authorize",code="5xx"}[5m])) / sum(rate(haproxy_server_http_responses_total{route="telemeter-server-authorize"}[5m]))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: 'errors',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Errors',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  decimals: null,
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: '0',
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 0,
              fillGradient: 0,
              gridPos: {
                h: 9,
                w: 7,
                x: 17,
                y: 10,
              },
              hiddenSeries: false,
              id: 91,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 1,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: '99th',
                  color: '#FA6400',
                },
                {
                  alias: '90th',
                  color: '#E0B400',
                },
                {
                  alias: '50th',
                  color: '#37872D',
                  fill: 10,
                  linewidth: 0,
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="authorize"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '99th',
                  refId: 'A',
                },
                {
                  expr: 'histogram_quantile(0.9, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="authorize"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '90th',
                  refId: 'B',
                },
                {
                  expr: 'histogram_quantile(0.5, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="authorize"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '50th',
                  refId: 'C',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Duration',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 's',
                  label: null,
                  logBase: 10,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 19,
              },
              id: 100,
              title: '/upload',
              type: 'row',
            },
            {
              cacheTimeout: null,
              colorBackground: false,
              colorPostfix: false,
              colorValue: true,
              colors: [
                '#d44a3a',
                'rgba(237, 129, 40, 0.89)',
                '#299c46',
              ],
              datasource: '$datasource',
              decimals: 3,
              format: 'percentunit',
              gauge: {
                maxValue: 100,
                minValue: 0,
                show: false,
                thresholdLabels: false,
                thresholdMarkers: true,
              },
              gridPos: {
                h: 9,
                w: 3,
                x: 0,
                y: 20,
              },
              id: 105,
              interval: null,
              links: [],
              mappingType: 1,
              mappingTypes: [
                {
                  name: 'value to text',
                  value: 1,
                },
                {
                  name: 'range to text',
                  value: 2,
                },
              ],
              maxDataPoints: 100,
              nullPointMode: 'connected',
              nullText: null,
              options: {},
              postfix: '',
              postfixFontSize: '50%',
              prefix: '',
              prefixFontSize: '50%',
              rangeMaps: [
                {
                  from: 'null',
                  text: 'N/A',
                  to: 'null',
                },
              ],
              sparkline: {
                fillColor: 'rgba(31, 118, 189, 0.18)',
                full: false,
                lineColor: 'rgb(31, 120, 193)',
                show: false,
                ymax: null,
                ymin: null,
              },
              tableColumn: '',
              targets: [
                {
                  expr: '1 -\nsum(increase(haproxy_server_http_responses_total{route=~"telemeter-server-authorize|telemeter-server-upload",code="5xx"}[$__range]))\n/\nsum(increase(haproxy_server_http_responses_total{route=~"telemeter-server-authorize|telemeter-server-upload"}[$__range]))\n',
                  instant: true,
                  refId: 'A',
                },
              ],
              thresholds: '.98,0.985',
              timeFrom: null,
              timeShift: null,
              title: 'Availability (selected time range)',
              type: 'singlestat',
              valueFontSize: '80%',
              valueMaps: [
                {
                  op: '=',
                  text: 'N/A',
                  value: 'null',
                },
              ],
              valueName: 'current',
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 9,
                w: 7,
                x: 3,
                y: 20,
              },
              hiddenSeries: false,
              id: 94,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: '1xx',
                  color: '#FADE2A',
                },
                {
                  alias: '2xx',
                  color: '#56A64B',
                },
                {
                  alias: '3xx',
                  color: '#5794F2',
                },
                {
                  alias: '4xx',
                  color: '#FF9830',
                },
                {
                  alias: '5xx',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum by (code) (rate(haproxy_server_http_responses_total{route="telemeter-server-upload"}[5m]))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '{{code}}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Requests',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 9,
                w: 7,
                x: 10,
                y: 20,
              },
              hiddenSeries: false,
              id: 97,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: 'errors',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(rate(haproxy_server_http_responses_total{route="telemeter-server-upload",code="5xx"}[5m])) / sum(rate(haproxy_server_http_responses_total{route="telemeter-server-upload"}[5m]))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: 'errors',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Errors',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  decimals: null,
                  format: 'percentunit',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: '0',
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              aliasColors: {
                '2xx': 'semi-dark-green',
                '{code="200"}': 'dark-green',
                '{code="429"}': 'dark-orange',
                '{code="500"}': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 0,
              fillGradient: 0,
              gridPos: {
                h: 9,
                w: 7,
                x: 17,
                y: 20,
              },
              hiddenSeries: false,
              id: 92,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 1,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 5,
              points: false,
              renderer: 'flot',
              repeatDirection: 'v',
              seriesOverrides: [
                {
                  alias: '99th',
                  color: '#FA6400',
                },
                {
                  alias: '90th',
                  color: '#E0B400',
                },
                {
                  alias: '50th',
                  color: '#37872D',
                  fill: 10,
                  linewidth: 0,
                },
              ],
              spaceLength: 10,
              stack: false,
              steppedLine: false,
              targets: [
                {
                  expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="upload"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '99th',
                  refId: 'A',
                },
                {
                  expr: 'histogram_quantile(0.9, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="upload"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '90th',
                  refId: 'B',
                },
                {
                  expr: 'histogram_quantile(0.5, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="upload"}[5m])))',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '50th',
                  refId: 'C',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Duration',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 's',
                  label: null,
                  logBase: 10,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              collapsed: true,
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 29,
              },
              id: 52,
              panels: [
                {
                  cacheTimeout: null,
                  colorBackground: false,
                  colorPostfix: false,
                  colorValue: true,
                  colors: [
                    '#d44a3a',
                    'rgba(237, 129, 40, 0.89)',
                    '#299c46',
                  ],
                  datasource: '$datasource',
                  decimals: 3,
                  format: 'percentunit',
                  gauge: {
                    maxValue: 100,
                    minValue: 0,
                    show: false,
                    thresholdLabels: false,
                    thresholdMarkers: true,
                  },
                  gridPos: {
                    h: 9,
                    w: 3,
                    x: 0,
                    y: 30,
                  },
                  id: 106,
                  interval: null,
                  links: [],
                  mappingType: 1,
                  mappingTypes: [
                    {
                      name: 'value to text',
                      value: 1,
                    },
                    {
                      name: 'range to text',
                      value: 2,
                    },
                  ],
                  maxDataPoints: 100,
                  nullPointMode: 'connected',
                  nullText: null,
                  options: {},
                  postfix: '',
                  postfixFontSize: '50%',
                  prefix: '',
                  prefixFontSize: '50%',
                  rangeMaps: [
                    {
                      from: 'null',
                      text: 'N/A',
                      to: 'null',
                    },
                  ],
                  sparkline: {
                    fillColor: 'rgba(31, 118, 189, 0.18)',
                    full: false,
                    lineColor: 'rgb(31, 120, 193)',
                    show: false,
                    ymax: null,
                    ymin: null,
                  },
                  tableColumn: '',
                  targets: [
                    {
                      expr: '1 - \nsum(increase(haproxy_server_http_responses_total{route="telemeter-server-metrics-v1-receive",code="5xx"}[$__range]))\n/\nsum(increase(haproxy_server_http_responses_total{route="telemeter-server-metrics-v1-receive"}[$__range]))',
                      instant: true,
                      refId: 'A',
                    },
                  ],
                  thresholds: '.90,0.92',
                  timeFrom: null,
                  timeShift: null,
                  title: 'Availability (selected time range)',
                  type: 'singlestat',
                  valueFontSize: '80%',
                  valueMaps: [
                    {
                      op: '=',
                      text: 'N/A',
                      value: 'null',
                    },
                  ],
                  valueName: 'current',
                },
                {
                  aliasColors: {
                    '2xx': 'semi-dark-green',
                    '{code="200"}': 'dark-green',
                    '{code="429"}': 'dark-orange',
                    '{code="500"}': 'dark-red',
                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  fillGradient: 0,
                  gridPos: {
                    h: 9,
                    w: 7,
                    x: 3,
                    y: 30,
                  },
                  hiddenSeries: false,
                  id: 95,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [],
                  nullPointMode: 'null',
                  options: {
                    dataLinks: [],
                  },
                  paceLength: 10,
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  repeatDirection: 'v',
                  seriesOverrides: [
                    {
                      alias: '1xx',
                      color: '#FADE2A',
                    },
                    {
                      alias: '2xx',
                      color: '#56A64B',
                    },
                    {
                      alias: '3xx',
                      color: '#5794F2',
                    },
                    {
                      alias: '4xx',
                      color: '#FF9830',
                    },
                    {
                      alias: '5xx',
                      color: '#C4162A',
                    },
                  ],
                  spaceLength: 10,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum by (code) (rate(haproxy_server_http_responses_total{route="telemeter-server-metrics-v1-receive"}[5m]))',
                      format: 'time_series',
                      intervalFactor: 1,
                      legendFormat: '{{code}}',
                      refId: 'A',
                    },
                  ],
                  thresholds: [],
                  timeFrom: null,
                  timeRegions: [],
                  timeShift: null,
                  title: 'Requests',
                  tooltip: {
                    shared: true,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [],
                  },
                  yaxes: [
                    {
                      format: 'reqps',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: true,
                    },
                  ],
                  yaxis: {
                    align: false,
                    alignLevel: null,
                  },
                },
                {
                  aliasColors: {
                    '2xx': 'semi-dark-green',
                    '{code="200"}': 'dark-green',
                    '{code="429"}': 'dark-orange',
                    '{code="500"}': 'dark-red',
                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  fillGradient: 0,
                  gridPos: {
                    h: 9,
                    w: 7,
                    x: 10,
                    y: 30,
                  },
                  hiddenSeries: false,
                  id: 98,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [],
                  nullPointMode: 'null',
                  options: {
                    dataLinks: [],
                  },
                  paceLength: 10,
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  repeatDirection: 'v',
                  seriesOverrides: [
                    {
                      alias: 'errors',
                      color: '#C4162A',
                    },
                  ],
                  spaceLength: 10,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum by (code) (rate(haproxy_server_http_responses_total{route="telemeter-server-metrics-v1-receive",code="5xx"}[5m])) / sum by (code) (rate(haproxy_server_http_responses_total{route="telemeter-server-metrics-v1-receive"}[5m]))',
                      format: 'time_series',
                      intervalFactor: 1,
                      legendFormat: 'errors',
                      refId: 'A',
                    },
                  ],
                  thresholds: [],
                  timeFrom: null,
                  timeRegions: [],
                  timeShift: null,
                  title: 'Errors',
                  tooltip: {
                    shared: true,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [],
                  },
                  yaxes: [
                    {
                      format: 'percentunit',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: '0',
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: true,
                    },
                  ],
                  yaxis: {
                    align: false,
                    alignLevel: null,
                  },
                },
                {
                  aliasColors: {
                    '2xx': 'semi-dark-green',
                    '{code="200"}': 'dark-green',
                    '{code="429"}': 'dark-orange',
                    '{code="500"}': 'dark-red',
                  },
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 0,
                  fillGradient: 0,
                  gridPos: {
                    h: 9,
                    w: 7,
                    x: 17,
                    y: 30,
                  },
                  hiddenSeries: false,
                  id: 93,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [],
                  nullPointMode: 'null',
                  options: {
                    dataLinks: [],
                  },
                  paceLength: 10,
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  repeatDirection: 'v',
                  seriesOverrides: [
                    {
                      alias: '99th',
                      color: '#FA6400',
                    },
                    {
                      alias: '90th',
                      color: '#E0B400',
                    },
                    {
                      alias: '50th',
                      color: '#37872D',
                      fill: 10,
                      linewidth: 0,
                    },
                  ],
                  spaceLength: 10,
                  stack: false,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="receive"}[5m])))',
                      format: 'time_series',
                      intervalFactor: 1,
                      legendFormat: '99th',
                      refId: 'A',
                    },
                    {
                      expr: 'histogram_quantile(0.9, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="receive"}[5m])))',
                      format: 'time_series',
                      intervalFactor: 1,
                      legendFormat: '90th',
                      refId: 'B',
                    },
                    {
                      expr: 'histogram_quantile(0.5, sum by (le) (rate(http_request_duration_seconds_bucket{job="telemeter-server",code!~"5..",handler="receive"}[5m])))',
                      format: 'time_series',
                      intervalFactor: 1,
                      legendFormat: '50th',
                      refId: 'C',
                    },
                  ],
                  thresholds: [],
                  timeFrom: null,
                  timeRegions: [],
                  timeShift: null,
                  title: 'Duration',
                  tooltip: {
                    shared: true,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [],
                  },
                  yaxes: [
                    {
                      format: 's',
                      label: null,
                      logBase: 10,
                      max: null,
                      min: null,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: true,
                    },
                  ],
                  yaxis: {
                    align: false,
                    alignLevel: null,
                  },
                },
              ],
              title: '/receive',
              type: 'row',
            },
            {
              collapsed: false,
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 30,
              },
              id: 47,
              panels: [],
              title: 'Oauth Client',
              type: 'row',
            },
            {
              aliasColors: {
                'Code: 200': 'dark-green',
                'Code: 500': 'dark-red',
              },
              bars: false,
              dashLength: 10,
              dashes: false,
              datasource: '$datasource',
              fill: 10,
              fillGradient: 0,
              gridPos: {
                h: 10,
                w: 24,
                x: 0,
                y: 31,
              },
              hiddenSeries: false,
              id: 44,
              legend: {
                avg: false,
                current: false,
                max: false,
                min: false,
                show: true,
                total: false,
                values: false,
              },
              lines: true,
              linewidth: 0,
              links: [],
              nullPointMode: 'null',
              options: {
                dataLinks: [],
              },
              paceLength: 10,
              percentage: false,
              pointradius: 2,
              points: false,
              renderer: 'flot',
              seriesOverrides: [
                {
                  alias: '1xx',
                  color: '#FADE2A',
                },
                {
                  alias: '2xx',
                  color: '#56A64B',
                },
                {
                  alias: '3xx',
                  color: '#5794F2',
                },
                {
                  alias: '4xx',
                  color: '#FF9830',
                },
                {
                  alias: '5xx',
                  color: '#C4162A',
                },
              ],
              spaceLength: 10,
              stack: true,
              steppedLine: false,
              targets: [
                {
                  expr: 'sum(label_replace(\n   rate(client_api_requests_total{namespace="$namespace",client="oauth"}[5m]),\n  "status_code", "${1}xx", "code", "([0-9]).."\n)) by (status_code)',
                  format: 'time_series',
                  intervalFactor: 1,
                  legendFormat: '{{ status_code }}',
                  refId: 'A',
                },
              ],
              thresholds: [],
              timeFrom: null,
              timeRegions: [],
              timeShift: null,
              title: 'Oauth Client Response Codes',
              tooltip: {
                shared: true,
                sort: 0,
                value_type: 'individual',
              },
              type: 'graph',
              xaxis: {
                buckets: null,
                mode: 'time',
                name: null,
                show: true,
                values: [],
              },
              yaxes: [
                {
                  format: 'reqps',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
                {
                  format: 'short',
                  label: null,
                  logBase: 1,
                  max: null,
                  min: null,
                  show: true,
                },
              ],
              yaxis: {
                align: false,
                alignLevel: null,
              },
            },
            {
              collapsed: true,
              datasource: null,
              gridPos: {
                h: 1,
                w: 24,
                x: 0,
                y: 41,
              },
              id: 54,
              panels: [
                {
                  aliasColors: {},
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  gridPos: {
                    h: 7,
                    w: 24,
                    x: 0,
                    y: 18,
                  },
                  id: 56,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [],
                  nullPointMode: 'null as zero',
                  paceLength: 10,
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [],
                  spaceLength: 10,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(namespace_pod_name_container_name:container_cpu_usage_seconds_total:sum_rate{namespace="$namespace"}) by (pod_name)',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{pod_name}}',
                      legendLink: null,
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [],
                  timeFrom: null,
                  timeRegions: [],
                  timeShift: null,
                  title: 'CPU Usage',
                  tooltip: {
                    shared: true,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                  yaxis: {
                    align: false,
                    alignLevel: null,
                  },
                },
                {
                  aliasColors: {},
                  bars: false,
                  columns: [],
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  fontSize: '100%',
                  gridPos: {
                    h: 7,
                    w: 24,
                    x: 0,
                    y: 25,
                  },
                  id: 57,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [],
                  nullPointMode: 'null as zero',
                  pageSize: null,
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  scroll: true,
                  seriesOverrides: [],
                  showHeader: true,
                  sort: {
                    col: 0,
                    desc: true,
                  },
                  spaceLength: 10,
                  stack: false,
                  steppedLine: false,
                  styles: [
                    {
                      alias: 'Time',
                      align: 'auto',
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      pattern: 'Time',
                      type: 'hidden',
                    },
                    {
                      alias: 'CPU Usage',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #A',
                      thresholds: [],
                      type: 'number',
                      unit: 'short',
                    },
                    {
                      alias: 'CPU Requests',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #B',
                      thresholds: [],
                      type: 'number',
                      unit: 'short',
                    },
                    {
                      alias: 'CPU Requests %',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #C',
                      thresholds: [],
                      type: 'number',
                      unit: 'percentunit',
                    },
                    {
                      alias: 'CPU Limits',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #D',
                      thresholds: [],
                      type: 'number',
                      unit: 'short',
                    },
                    {
                      alias: 'CPU Limits %',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #E',
                      thresholds: [],
                      type: 'number',
                      unit: 'percentunit',
                    },
                    {
                      alias: 'Pod',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: true,
                      linkTooltip: 'Drill down',
                      linkUrl: '/d/k8s-compute-resources-pod/k8s-compute-resources-pod?var-datasource=$datasource&var-namespace=$namespace&var-pod=$__cell',
                      pattern: 'pod',
                      thresholds: [],
                      type: 'number',
                      unit: 'short',
                    },
                    {
                      alias: '',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      pattern: '/.*/',
                      thresholds: [],
                      type: 'string',
                      unit: 'short',
                    },
                  ],
                  targets: [
                    {
                      expr: 'sum(label_replace(namespace_pod_name_container_name:container_cpu_usage_seconds_total:sum_rate{namespace="$namespace"}, "pod", "$1", "pod_name", "(.*)")) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'A',
                      step: 10,
                    },
                    {
                      expr: 'sum(kube_pod_container_resource_requests_cpu_cores{namespace="$namespace"}) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'B',
                      step: 10,
                    },
                    {
                      expr: 'sum(label_replace(namespace_pod_name_container_name:container_cpu_usage_seconds_total:sum_rate{namespace="$namespace"}, "pod", "$1", "pod_name", "(.*)")) by (pod) / sum(kube_pod_container_resource_requests_cpu_cores{namespace="$namespace"}) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'C',
                      step: 10,
                    },
                    {
                      expr: 'sum(kube_pod_container_resource_limits_cpu_cores{namespace="$namespace"}) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'D',
                      step: 10,
                    },
                    {
                      expr: 'sum(label_replace(namespace_pod_name_container_name:container_cpu_usage_seconds_total:sum_rate{namespace="$namespace"}, "pod", "$1", "pod_name", "(.*)")) by (pod) / sum(kube_pod_container_resource_limits_cpu_cores{namespace="$namespace"}) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'E',
                      step: 10,
                    },
                  ],
                  thresholds: [],
                  timeFrom: null,
                  timeShift: null,
                  title: 'CPU Quota',
                  tooltip: {
                    shared: true,
                    sort: 0,
                    value_type: 'individual',
                  },
                  transform: 'table',
                  type: 'table',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
                {
                  aliasColors: {},
                  bars: false,
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 10,
                  gridPos: {
                    h: 7,
                    w: 24,
                    x: 0,
                    y: 32,
                  },
                  id: 58,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 0,
                  links: [],
                  nullPointMode: 'null as zero',
                  paceLength: 10,
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  seriesOverrides: [],
                  spaceLength: 10,
                  stack: true,
                  steppedLine: false,
                  targets: [
                    {
                      expr: 'sum(container_memory_usage_bytes{namespace="$namespace", container_name!=""}) by (pod_name)',
                      format: 'time_series',
                      intervalFactor: 2,
                      legendFormat: '{{pod_name}}',
                      legendLink: null,
                      refId: 'A',
                      step: 10,
                    },
                  ],
                  thresholds: [],
                  timeFrom: null,
                  timeRegions: [],
                  timeShift: null,
                  title: 'Memory Usage',
                  tooltip: {
                    shared: true,
                    sort: 0,
                    value_type: 'individual',
                  },
                  type: 'graph',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                  yaxis: {
                    align: false,
                    alignLevel: null,
                  },
                },
                {
                  aliasColors: {},
                  bars: false,
                  columns: [],
                  dashLength: 10,
                  dashes: false,
                  datasource: '$datasource',
                  fill: 1,
                  fontSize: '100%',
                  gridPos: {
                    h: 7,
                    w: 24,
                    x: 0,
                    y: 39,
                  },
                  id: 34,
                  legend: {
                    avg: false,
                    current: false,
                    max: false,
                    min: false,
                    show: true,
                    total: false,
                    values: false,
                  },
                  lines: true,
                  linewidth: 1,
                  links: [],
                  nullPointMode: 'null as zero',
                  pageSize: null,
                  percentage: false,
                  pointradius: 5,
                  points: false,
                  renderer: 'flot',
                  scroll: true,
                  seriesOverrides: [],
                  showHeader: true,
                  sort: {
                    col: 0,
                    desc: true,
                  },
                  spaceLength: 10,
                  stack: false,
                  steppedLine: false,
                  styles: [
                    {
                      alias: 'Time',
                      align: 'auto',
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      pattern: 'Time',
                      type: 'hidden',
                    },
                    {
                      alias: 'Memory Usage',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #A',
                      thresholds: [],
                      type: 'number',
                      unit: 'decbytes',
                    },
                    {
                      alias: 'Memory Requests',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #B',
                      thresholds: [],
                      type: 'number',
                      unit: 'decbytes',
                    },
                    {
                      alias: 'Memory Requests %',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #C',
                      thresholds: [],
                      type: 'number',
                      unit: 'percentunit',
                    },
                    {
                      alias: 'Memory Limits',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #D',
                      thresholds: [],
                      type: 'number',
                      unit: 'decbytes',
                    },
                    {
                      alias: 'Memory Limits %',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: false,
                      linkTooltip: 'Drill down',
                      linkUrl: '',
                      pattern: 'Value #E',
                      thresholds: [],
                      type: 'number',
                      unit: 'percentunit',
                    },
                    {
                      alias: 'Pod',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      link: true,
                      linkTooltip: 'Drill down',
                      linkUrl: '/d/k8s-compute-resources-pod/k8s-compute-resources-pod?var-datasource=$datasource&var-namespace=$namespace&var-pod=$__cell',
                      pattern: 'pod',
                      thresholds: [],
                      type: 'number',
                      unit: 'short',
                    },
                    {
                      alias: '',
                      align: 'auto',
                      colorMode: null,
                      colors: [],
                      dateFormat: 'YYYY-MM-DD HH:mm:ss',
                      decimals: 2,
                      pattern: '/.*/',
                      thresholds: [],
                      type: 'string',
                      unit: 'short',
                    },
                  ],
                  targets: [
                    {
                      expr: 'sum(label_replace(container_memory_usage_bytes{namespace="$namespace",container_name!=""}, "pod", "$1", "pod_name", "(.*)")) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'A',
                      step: 10,
                    },
                    {
                      expr: 'sum(kube_pod_container_resource_requests_memory_bytes{namespace="$namespace"}) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'B',
                      step: 10,
                    },
                    {
                      expr: 'sum(label_replace(container_memory_usage_bytes{namespace="$namespace",container_name!=""}, "pod", "$1", "pod_name", "(.*)")) by (pod) / sum(kube_pod_container_resource_requests_memory_bytes{namespace="$namespace"}) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'C',
                      step: 10,
                    },
                    {
                      expr: 'sum(kube_pod_container_resource_limits_memory_bytes{namespace="$namespace"}) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'D',
                      step: 10,
                    },
                    {
                      expr: 'sum(label_replace(container_memory_usage_bytes{namespace="$namespace",container_name!=""}, "pod", "$1", "pod_name", "(.*)")) by (pod) / sum(kube_pod_container_resource_limits_memory_bytes{namespace="$namespace"}) by (pod)',
                      format: 'table',
                      instant: true,
                      intervalFactor: 2,
                      legendFormat: '',
                      refId: 'E',
                      step: 10,
                    },
                  ],
                  thresholds: [],
                  timeFrom: null,
                  timeShift: null,
                  title: 'Memory Quota',
                  tooltip: {
                    shared: true,
                    sort: 0,
                    value_type: 'individual',
                  },
                  transform: 'table',
                  type: 'table',
                  xaxis: {
                    buckets: null,
                    mode: 'time',
                    name: null,
                    show: true,
                    values: [],
                  },
                  yaxes: [
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: 0,
                      show: true,
                    },
                    {
                      format: 'short',
                      label: null,
                      logBase: 1,
                      max: null,
                      min: null,
                      show: false,
                    },
                  ],
                },
              ],
              title: 'Resource Usage: Namespace',
              type: 'row',
            },
          ],
          refresh: '1m',
          schemaVersion: 22,
          style: 'dark',
          tags: [],
          templating: {
            list: [
              {
                current: {
                  selected: true,
                  text: 'telemeter-prod-01-prometheus',
                  value: 'telemeter-prod-01-prometheus',
                },
                hide: 0,
                includeAll: false,
                label: null,
                multi: false,
                name: 'datasource',
                options: [],
                query: 'prometheus',
                refresh: 1,
                regex: '',
                skipUrlSync: false,
                type: 'datasource',
              },
              {
                allValue: null,
                current: {
                  isNone: true,
                  selected: true,
                  text: 'None',
                  value: '',
                },
                datasource: '$datasource',
                definition: 'label_values(kube_pod_info, cluster)',
                hide: 0,
                includeAll: false,
                label: 'cluster',
                multi: false,
                name: 'cluster',
                options: [],
                query: 'label_values(kube_pod_info, cluster)',
                refresh: 1,
                regex: '',
                skipUrlSync: false,
                sort: 0,
                tagValuesQuery: '',
                tags: [],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
              {
                allValue: null,
                current: {
                  text: 'telemeter-production',
                  value: 'telemeter-production',
                },
                datasource: '$datasource',
                definition: 'label_values(kube_pod_info{cluster="$cluster"}, namespace)',
                hide: 0,
                includeAll: false,
                label: 'namespace',
                multi: false,
                name: 'namespace',
                options: [],
                query: 'label_values(kube_pod_info{cluster="$cluster"}, namespace)',
                refresh: 1,
                regex: '^telemeter.*',
                skipUrlSync: false,
                sort: 2,
                tagValuesQuery: '',
                tags: [],
                tagsQuery: '',
                type: 'query',
                useTags: false,
              },
            ],
          },
          time: {
            from: 'now-1h',
            to: 'now',
          },
          timepicker: {
            refresh_intervals: [
              '5s',
              '10s',
              '30s',
              '1m',
              '5m',
              '15m',
              '30m',
              '1h',
              '2h',
              '1d',
            ],
            time_options: [
              '5m',
              '15m',
              '1h',
              '6h',
              '12h',
              '24h',
              '2d',
              '7d',
              '30d',
            ],
          },
          timezone: '',
          title: 'Telemeter',
          uid: 'Tg-mH0rizaSJDKSADJ',
          version: 1,
        }, '  ',
      ),
    }),
}
